{"tiddlers":{"$:/plugins/tiddlywiki/ai-tools/docs":{"title":"$:/plugins/tiddlywiki/ai-tools/docs","text":""},"$:/plugins/tiddlywiki/ai-tools/globals":{"title":"$:/plugins/tiddlywiki/ai-tools/globals","tags":"$:/tags/Global","text":"\\function default-llm-completion-server()\n[all[shadows+tiddlers]tag[$:/tags/AI/CompletionServer]sort[caption]first[]]\n\\end\n\n<!--\nAction procedure to retrieve an LLM completion, given the following parameters:\nconversationTitle - Title of the tiddler containing the conversation\nresultTitlePrefix - Prefix of the tiddler to be used for saving the result. If the tiddler already exists then a number will be added repeatedly until the resulting title is unique\nresultTags - Tags to be applied to the result tiddler\nstatusTitle - Optional title of a tiddler to which the status of the request will be bound: \"pending\", \"complete\", \"error\"\ncompletionServer - Optional URL of server\n-->\n\\procedure get-llm-completion(conversationTitle,resultTitlePrefix,resultTags,statusTitle,completionServer)\n\t<!--\n\tCallback for the HTTP response from the LLM\n\t-->\n\t\\procedure get-llm-completion-callback()\n\t\t<%if [<status>compare:number:gteq[200]compare:number:lteq[299]] %>\n\t\t\t<!-- Success -->\n\t\t\t<$action-createtiddler\n\t\t\t\t$basetitle=<<resultTitlePrefix>>\n\t\t\t\ttags=<<resultTags>>\n\t\t\t\ttype=\"text/markdown\"\n\t\t\t\trole={{{ [<data>jsonget[choices],[0],[message],[role]] }}}\n\t\t\t\ttext={{{ [<data>jsonget[choices],[0],[message],[content]] }}}\n\t\t\t/>\n\t\t<%else%>\n\t\t\t<!-- Error -->\n\t\t\t<$action-createtiddler\n\t\t\t\t$basetitle=<<resultTitlePrefix>>\n\t\t\t\ttags=<<resultTags>>\n\t\t\t\ttype=\"text/markdown\"\n\t\t\t\trole=\"error\"\n\t\t\t\ttext={{{ [[Error:]] [<statusText>] [<data>jsonget[error],[message]]  +[join[]] }}}\n\t\t\t/>\n\t\t<%endif%>\n\t\\end get-llm-completion-callback\n\n<$let\n\tcompletionServer={{{ [<completionServer>!is[blank]else<default-llm-completion-server>] }}}\n>\n\t<$wikify name=\"json\" text={{{ [<completionServer>get[text]] }}}>\n\t\t<$action-log message=\"get-llm-completion\"/>\n\t\t<$action-log/>\n\t\t<$action-sendmessage\n\t\t\t$message=\"tm-http-request\"\n\t\t\turl={{{ [<completionServer>get[url]addsuffix[/v1/chat/completions]] }}}\n\t\t\tbody=<<json>>\n\t\t\theader-content-type=\"application/json\"\n\t\t\tbearer-auth-token-from-store=\"openai-secret-key\"\n\t\t\tmethod=\"POST\"\n\t\t\toncompletion=<<get-llm-completion-callback>>\n\t\t\tbind-status=<<statusTitle>>\n\t\t\tvar-resultTitlePrefix=<<resultTitlePrefix>>\n\t\t\tvar-resultTags=<<resultTags>>\n\t\t/>\n\t</$wikify>\n</$let>\n\\end get-llm-completion\n"},"$:/plugins/tiddlywiki/ai-tools/icon":{"title":"$:/plugins/tiddlywiki/ai-tools/icon","tags":"$:/tags/Image","text":"<svg class=\"tc-image-ai-tools tc-image-button\" width=\"128px\" height=\"128px\" viewBox=\"0 0 1080 1080\">\n<path d=\"M305.944 180.972c-4.529 18.383-23.13 29.63-41.51 25.102-18.384-4.528-29.632-23.128-25.103-41.511 0 0 10.422-42.42 36.148-78.95 29.997-42.591 78.27-76.963 149.535-49.535 34.919 13.439 64.239 46.89 77.213 85.897 11.983 36.019 10.002 75.903-10.442 107.875-13.636 21.324-35.535 39.692-68.572 50.336-18.02 5.806-37.363-4.11-43.169-22.13-5.805-18.02 4.11-37.364 22.13-43.17 15.021-4.839 25.613-12.301 31.814-21.997 9.31-14.561 8.598-32.856 3.142-49.26-6.4-19.24-19.534-36.896-36.758-43.524-33.12-12.747-54.862 5.218-68.803 25.012-18.207 25.852-25.625 55.855-25.625 55.855Z\"/><path d=\"M215.5 296.178c6.14 17.91-3.415 37.435-21.323 43.575-17.91 6.14-37.434-3.416-43.574-21.324-18.546-54.095-15.994-104.758 9.305-136.356 24.682-30.825 74.9-50.135 163.229-27.59 18.344 4.682 29.435 23.377 24.753 41.72-4.682 18.344-23.376 29.436-41.72 24.754-28.772-7.344-51.456-9.633-69.012-7.005-10.73 1.607-18.784 4.864-23.697 11.001-5.137 6.415-6.646 15.043-6.789 24.56-.213 14.268 3.182 30.198 8.828 46.665ZM436.985 252.197c-12.96-13.8-12.279-35.528 1.522-48.488 13.8-12.96 35.527-12.277 48.487 1.523 40.63 43.264 50.407 148.647-34.799 217.781-14.7 11.93-36.321 9.678-48.25-5.023-11.928-14.701-9.677-36.321 5.024-48.25 29.58-24.001 41.25-55.017 40.243-81.657-.55-14.535-4.532-27.692-12.227-35.886Z\"/><path d=\"M429.75 398.261c-13.05-13.719-12.504-35.448 1.214-48.496 13.718-13.047 35.447-12.504 48.495 1.215 36.375 38.243 49.687 105.469 42.54 161.512-4.58 35.918-28.959 69.69-46.205 86.964-13.378 13.396-35.114 13.412-48.511.035-13.397-13.377-13.413-35.114-.036-48.511 9.493-9.506 24.178-27.399 26.699-47.167 4.634-36.335-.613-80.757-24.197-105.552ZM383.892 358.862c-2.508 1.598-15.19 9.815-22.55 17.348-12.496 12.791-24.365 29.217-31.726 44.936-3.41 7.28-6.167 14.127-6.064 20.028.33 18.928-14.77 34.565-33.7 34.895-18.929.329-34.565-14.772-34.894-33.7-.563-32.303 25.612-81.652 57.31-114.1 25.73-26.337 55.55-39.665 74.95-37.865 18.851 1.748 32.736 18.474 30.986 37.325-1.655 17.84-16.723 31.232-34.312 31.133Z\"/><path d=\"M324.427 491.47c14.336-12.364 36.014-10.765 48.38 3.57 12.365 14.336 10.766 36.014-3.57 48.38-35.278 30.43-83.446 31.97-126.059 13.862-39.875-16.945-73.415-51.03-84.769-87.508-5.626-18.078 4.483-37.32 22.56-42.948 18.076-5.625 37.32 4.483 42.946 22.56 5.987 19.237 25.066 35.82 46.094 44.755 18.307 7.78 39.262 10.403 54.418-2.67ZM238.158 848.992c-18.354 4.646-37.026-6.482-41.671-24.836-4.646-18.353 6.482-37.024 24.836-41.67 66.855-16.924 106.045-8.36 132.668 12.067 25.26 19.38 40.528 52.883 55.041 98.202 5.774 18.03-4.176 37.356-22.207 43.13-18.03 5.774-37.356-4.177-43.13-22.207-9.273-28.962-15.324-52.31-31.466-64.696-14.802-11.357-36.898-9.4-74.07.01ZM378.524 310.429c7.245 17.49-1.073 37.573-18.564 44.818-17.49 7.245-37.573-1.072-44.819-18.564-3.546-8.561-9.483-19.043-17.183-27.827-4.99-5.692-10.358-11.387-17.173-12.568-18.655-3.233-31.174-21.003-27.941-39.656 3.232-18.654 21.001-31.174 39.656-27.941 17.7 3.068 34.339 12.535 48.427 25.942 17.085 16.26 30.358 38.32 37.597 55.796Z\"/><path d=\"M239.891 535.075c3.65-18.577 21.694-30.697 40.271-27.049 18.577 3.65 30.697 21.694 27.048 40.271-2.923 14.88-1.783 29.068 6.746 38.756 9.265 10.522 25.559 14.054 47.798 11.971 18.849-1.764 35.586 12.106 37.35 30.956 1.765 18.849-12.105 35.585-30.955 37.35-50.24 4.705-84.758-11.171-105.687-34.946-21.657-24.602-29.993-59.525-22.571-97.31ZM354.12 837.055c-10.986 15.418-32.423 19.018-47.842 8.032-15.419-10.986-19.017-32.423-8.032-47.842 15.691-22.023 3.833-50.207-9.605-63.6-13.41-13.364-13.447-35.1-.082-48.51 13.364-13.41 35.1-13.447 48.51-.083 31.956 31.846 54.365 99.631 17.05 152.003Z\"/><path d=\"M417.527 595.761c-17.507-7.205-25.87-27.268-18.665-44.776 7.206-17.507 27.27-25.87 44.776-18.665 57.99 23.868 83.891 91.28 84.06 141.282.178 52.646-18.703 97.781-81.71 140.634-15.654 10.646-37.008 6.58-47.654-9.074-10.647-15.654-6.582-37.008 9.073-47.654 38.099-25.913 51.794-51.84 51.687-83.674-.091-26.902-10.368-65.232-41.567-78.073ZM172.415 529.364c17.772 6.526 26.903 26.252 20.377 44.023-6.525 17.773-26.252 26.903-44.023 20.378C24.339 548.077 28.366 421.967 45.089 383.42c19.146-44.127 67.192-99.355 131.797-103.4 28.152-1.762 59.932 5.57 94.086 28.92 15.629 10.686 19.643 32.048 8.958 47.677-10.684 15.63-32.047 19.643-47.676 8.959-18.69-12.778-35.676-18.049-51.08-17.084-37.039 2.32-62.172 36.934-73.147 62.233-9.627 22.188-7.235 92.34 64.388 118.639Z\"/><path d=\"M136.037 705.581c18.014-5.823 37.367 4.075 43.19 22.09 5.822 18.014-4.077 37.366-22.09 43.19-19.923 6.438-40.903 4.153-61.103-6.181-22.456-11.487-44.48-34.158-60.574-62.938-40.207-71.906-41.207-176.467 47.86-216.348 17.28-7.736 37.59.011 45.325 17.288 7.738 17.28-.009 37.589-17.287 45.327-48.764 21.836-38.032 80.883-16.02 120.25 7.603 13.594 16.929 25.328 27.303 32.534 4.522 3.142 8.837 6.262 13.396 4.788Z\"/><path d=\"M248.445 886.638c15.894-10.285 37.148-5.73 47.432 10.164 10.287 15.895 5.73 37.15-10.163 47.434-53.363 34.528-114.48 13.61-153.446-35.918-31.476-40.009-46.816-97.981-29.338-150.663 11.616-35.02 37.406-68.42 84.182-92.108 16.89-8.554 37.545-1.787 46.1 15.103 8.553 16.888 1.785 37.545-15.104 46.1-27.194 13.773-43.308 32.146-50.064 52.505-10.078 30.384-.01 63.57 18.144 86.645 16.225 20.623 40.037 35.114 62.257 20.738Z\"/><path d=\"M424.239 797.205c-11.475-15.058-8.566-36.6 6.492-48.075 15.056-11.474 36.598-8.565 48.074 6.492 37.195 48.81 58.176 116.704 41.374 176.81-11.601 41.499-40.413 80.337-95.642 106.95-19.606 9.448-57.262 16.88-94.45 12.56-36.634-4.256-71.897-19.84-92.568-49.946-13.98-20.36-22.138-47.772-17.69-84.642 2.267-18.796 19.367-32.215 38.163-29.947 18.796 2.267 32.215 19.368 29.947 38.163-1.96 16.242-.022 28.624 6.135 37.593 9.538 13.891 27.025 18.669 43.93 20.632 22.281 2.589 45.004-.555 56.751-6.216 33.49-16.138 52.318-38.453 59.352-63.618 11.152-39.891-5.182-84.362-29.868-116.756ZM843.902 164.563c4.529 18.383-6.72 36.983-25.103 41.511-18.381 4.529-36.982-6.72-41.51-25.102 0 0-7.418-30.003-25.625-55.855-13.941-19.794-35.683-37.76-68.804-25.012-17.224 6.628-30.358 24.283-36.757 43.523-5.457 16.405-6.17 34.7 3.142 49.261 6.2 9.696 16.792 17.158 31.813 21.998 18.021 5.805 27.936 25.15 22.13 43.169-5.806 18.02-25.149 27.936-43.169 22.13-33.036-10.644-54.935-29.012-68.572-50.336-20.444-31.972-22.424-71.856-10.442-107.875C593.98 82.967 623.3 49.517 658.22 36.078c71.265-27.428 119.538 6.944 149.535 49.535 25.725 36.53 36.148 78.95 36.148 78.95Z\"/><path d=\"M932.634 318.43c-6.14 17.907-25.665 27.463-43.574 21.323-17.908-6.14-27.463-25.665-21.323-43.575 5.646-16.467 9.041-32.397 8.828-46.666-.143-9.516-1.652-18.144-6.789-24.559-4.913-6.137-12.967-9.394-23.697-11.001-17.556-2.628-40.24-.34-69.012 7.005-18.344 4.682-37.038-6.41-41.72-24.754-4.682-18.343 6.409-37.038 24.753-41.72 88.328-22.545 138.547-3.235 163.23 27.59 25.298 31.598 27.85 82.26 9.304 136.356ZM596.242 205.232c12.96-13.8 34.687-14.482 48.487-1.523 13.8 12.96 14.483 34.687 1.522 48.488-7.695 8.194-11.677 21.35-12.227 35.886-1.006 26.64 10.663 57.656 40.243 81.657 14.7 11.929 16.952 33.549 5.023 48.25-11.928 14.7-33.548 16.952-48.25 5.023-85.205-69.134-75.428-174.517-34.798-217.78Z\"/><path d=\"M603.778 350.98c13.048-13.72 34.777-14.262 48.495-1.215 13.718 13.048 14.263 34.777 1.215 48.496-23.584 24.795-28.831 69.217-24.197 105.552 2.521 19.768 17.206 37.66 26.699 47.167 13.377 13.397 13.361 35.134-.036 48.51-13.397 13.378-35.133 13.362-48.511-.034-17.246-17.273-41.625-51.046-46.205-86.964-7.147-56.043 6.165-123.27 42.54-161.512ZM699.345 358.862c-17.589.099-32.657-13.294-34.312-31.133-1.75-18.851 12.135-35.577 30.986-37.325 19.4-1.8 49.22 11.528 74.95 37.866 31.698 32.447 57.873 81.796 57.31 114.099-.33 18.928-15.965 34.029-34.894 33.7-18.93-.33-34.03-15.967-33.7-34.895.103-5.901-2.653-12.747-6.064-20.028-7.36-15.72-19.23-32.145-31.726-44.936-7.36-7.533-20.042-15.75-22.55-17.348Z\"/><path d=\"M713.999 543.42c-14.336-12.366-15.935-34.044-3.57-48.38 12.366-14.335 34.044-15.934 48.38-3.57 15.156 13.074 36.11 10.45 54.418 2.671 21.028-8.935 40.107-25.518 46.094-44.754 5.626-18.078 24.87-28.186 42.946-22.56 18.077 5.627 28.186 24.87 22.56 42.947-11.354 36.479-44.894 70.563-84.77 87.508C797.446 575.39 749.278 573.85 714 543.42ZM861.917 782.485c18.354 4.647 29.482 23.318 24.836 41.671-4.645 18.354-23.317 29.482-41.671 24.836-37.173-9.41-59.269-11.367-74.071-.01-16.142 12.386-22.193 35.734-31.467 64.696-5.773 18.03-25.1 27.981-43.13 22.207-18.03-5.774-27.98-25.1-22.206-43.13 14.513-45.319 29.782-78.822 55.041-98.202 26.623-20.426 65.813-28.991 132.668-12.068ZM768.096 336.683c-7.246 17.492-27.328 25.81-44.82 18.564-17.49-7.245-25.808-27.327-18.563-44.818 7.24-17.476 20.512-39.536 37.597-55.796 14.088-13.407 30.726-22.874 48.427-25.942 18.655-3.233 36.424 9.287 39.656 27.94 3.233 18.654-9.286 36.424-27.94 39.657-6.816 1.18-12.184 6.876-17.174 12.568-7.7 8.784-13.637 19.266-17.183 27.827Z\"/><path d=\"M776.026 548.297c-3.649-18.577 8.47-36.621 27.048-40.27 18.577-3.649 36.622 8.47 40.271 27.048 7.422 37.784-.914 72.707-22.57 97.31-20.93 23.774-55.448 39.65-105.688 34.945-18.85-1.765-32.72-18.501-30.955-37.35 1.764-18.85 18.501-32.72 37.35-30.956 22.24 2.083 38.533-1.449 47.798-11.971 8.529-9.688 9.67-23.875 6.746-38.756ZM784.996 797.245c10.985 15.42 7.386 36.856-8.033 47.842-15.418 10.986-36.856 7.386-47.84-8.032-37.316-52.372-14.907-120.157 17.049-152.003 13.41-13.364 35.147-13.327 48.51.082 13.365 13.41 13.328 35.147-.082 48.511-13.438 13.393-25.296 41.577-9.604 63.6Z\"/><path d=\"M639.599 532.32c17.506-7.205 37.57 1.158 44.776 18.665 7.205 17.508-1.158 37.571-18.665 44.776-31.199 12.841-41.476 51.17-41.567 78.073-.107 31.833 13.588 57.761 51.687 83.674 15.655 10.646 19.72 32 9.073 47.654-10.646 15.654-32 19.72-47.655 9.074-63.006-42.853-81.887-87.988-81.708-140.634.168-50.002 26.07-117.414 84.059-141.282ZM934.468 593.765c-17.771 6.525-37.498-2.605-44.023-20.378-6.526-17.77 2.605-37.497 20.377-44.023 71.623-26.298 74.015-96.45 64.388-118.639-10.975-25.3-36.108-59.914-73.147-62.233-15.404-.965-32.39 4.306-51.08 17.084-15.629 10.684-36.992 6.67-47.676-8.96-10.685-15.628-6.67-36.99 8.958-47.675 34.154-23.35 65.934-30.683 94.086-28.92 64.605 4.044 112.651 59.272 131.796 103.4 16.724 38.546 20.751 164.656-103.679 210.344Z\"/><path d=\"M926.1 770.86c-18.013-5.823-27.912-25.175-22.09-43.19 5.823-18.014 25.176-27.912 43.19-22.089 4.56 1.474 8.874-1.646 13.396-4.788 10.374-7.206 19.7-18.94 27.302-32.534 22.013-39.367 32.745-98.414-16.019-120.25-17.278-7.738-25.025-28.048-17.287-45.327 7.736-17.277 28.046-25.024 45.325-17.288 89.067 39.881 88.067 144.442 47.86 216.348-16.093 28.78-38.118 51.45-60.574 62.938-20.2 10.334-41.18 12.619-61.102 6.18Z\"/><path d=\"M797.523 944.236c-15.894-10.284-20.45-31.539-10.163-47.434 10.284-15.895 31.538-20.45 47.432-10.164 22.22 14.376 46.032-.115 62.257-20.738 18.154-23.075 28.222-56.26 18.144-86.645-6.756-20.359-22.87-38.732-50.064-52.506-16.89-8.554-23.657-29.21-15.104-46.1 8.555-16.889 29.21-23.656 46.1-15.102 46.776 23.689 72.566 57.088 84.182 92.108 17.478 52.682 2.138 110.654-29.338 150.663-38.966 49.529-100.083 70.446-153.446 35.918Z\"/><path d=\"M604.432 755.622c11.476-15.057 33.018-17.966 48.074-6.492 15.058 11.476 17.967 33.017 6.492 48.075-24.686 32.394-41.02 76.865-29.868 116.756 7.034 25.165 25.861 47.48 59.352 63.618 11.747 5.66 34.47 8.805 56.752 6.216 16.904-1.963 34.39-6.74 43.929-20.632 6.157-8.969 8.095-21.351 6.135-37.593-2.268-18.795 11.15-35.896 29.947-38.163 18.796-2.268 35.896 11.15 38.163 29.947 4.448 36.87-3.71 64.282-17.69 84.642-20.67 30.106-55.934 45.69-92.568 49.945-37.188 4.32-74.844-3.111-94.45-12.559-55.229-26.613-84.04-65.451-95.642-106.95-16.802-60.106 4.179-128 41.374-176.81Z\"/></svg>"},"$:/plugins/tiddlywiki/ai-tools/page-menu/new-conversation":{"title":"$:/plugins/tiddlywiki/ai-tools/page-menu/new-conversation","tags":"$:/tags/AI/PageMenu","text":"\\define actions()\n<$action-createtiddler\n\t$basetitle=\"AI Conversation\"\n\ttags=\"$:/tags/AI/Conversation\"\n\tsystem-prompt=\"You are a helpful assistant.\"\n\tcurrent-response-text=\"Please list the 10 most important mechanical inventions of the Twentieth Century\"\n>\n<$action-navigate $to=<<createTiddler-title>>/>\n</$action-createtiddler>\n\\end actions\n\n<$button actions=<<actions>> class=\"tc-btn-invisible\">\n{{$:/core/images/new-button}} New Conversation\n</$button>\n"},"$:/plugins/tiddlywiki/ai-tools/page-menu":{"title":"$:/plugins/tiddlywiki/ai-tools/page-menu","tags":"$:/tags/PageControls","caption":"{{$:/plugins/tiddlywiki/ai-tools/icon}} AI Tools","description":"Tools for interactive AI services","text":"\\whitespace trim\n<$button popup=<<qualify \"$:/state/popup/ai-tools/page-menu\">> tooltip=\"Tools for interactive AI services\" aria-label=\"AI Tools\" class=<<tv-config-toolbar-class>> selectedClass=\"tc-selected\">\n\t<%if [<tv-config-toolbar-icons>match[yes]] %>\n\t\t{{$:/plugins/tiddlywiki/ai-tools/icon}}\n\t<%endif%>\n\t<%if [<tv-config-toolbar-text>match[yes]] %>\n\t\t<span class=\"tc-btn-text\"><$text text=\"AI Tools\"/></span>\n\t<%endif%>\n</$button>\n<$reveal state=<<qualify \"$:/state/popup/ai-tools/page-menu\">> type=\"popup\" position=\"belowleft\" animate=\"yes\">\n\t<div class=\"tc-drop-down\">\n\t\t<$list filter=\"[all[shadows+tiddlers]tag[$:/tags/AI/PageMenu]!has[draft.of]]\" variable=\"listItem\">\n\t\t\t<$transclude tiddler=<<listItem>>/>\n\t\t</$list>\n\t</div>\n</$reveal>\n"},"$:/plugins/tiddlywiki/ai-tools/readme":{"title":"$:/plugins/tiddlywiki/ai-tools/readme","text":"!! AI Tools for TiddlyWiki\n\nThis plugin adds integrated LLM conversations to the TiddlyWiki platform.\n\n# Click the {{||$:/plugins/tiddlywiki/ai-tools/page-menu}} icon in the sidebar to open a new conversation\n# Choose the server from the dropdown:\n#* ''Locally running Llamafile server'' - LLlamafile is an open source project that lets you distribute and run LLMs as a single file. The files are large, typically 4+ gigabytes but offer reasonable performance on modern hardware, and total privacy\n#* ''~OpenAI Service'' - ~OpenAI is a commercial service that offers paid APIs for accessing some of the most sophisticated LLMs that are available. ~OpenAI requires tokens to be purchased for API usage (this is entirely separate from ~ChatGPT subscriptions)\n# Type a prompt for the LLM in the text box\n#* If using ~OpenAI it is possible to attach a single image to a prompt\n# Click \"Send\" and wait for the output of the LLM\n"},"$:/plugins/tiddlywiki/ai-tools/servers/local-llamafile":{"title":"$:/plugins/tiddlywiki/ai-tools/servers/local-llamafile","tags":"$:/tags/AI/CompletionServer","url":"http://127.0.0.1:8080","caption":"Locally running Llamafile server","text":"\\rules only filteredtranscludeinline transcludeinline macrodef macrocallinline html conditional commentblock commentinline\n{\n\t\"model\": \"gpt-4o\",\n\t\"messages\": [\n\t\t{\n\t\t\t\"role\": \"system\",\n\t\t\t\"content\": \"<$text text={{{ [<conversationTitle>get[system-prompt]jsonstringify[]] }}}/>\"\n\t\t}\n\t\t<!-- Loop through the tiddlers tagged with this one to pick up all the messages in the conversation -->\n\t\t<$list filter=\"[all[shadows+tiddlers]tag<conversationTitle>!is[draft]sort[created]]\">\n\t\t\t,\n\t\t\t{\n\t\t\t\t<!-- We use JSON stringify to escape the characters that can't be used directly in JSON -->\n\t\t\t\t\"role\": \"<$text text={{{ [<currentTiddler>get[role]jsonstringify[]] }}}/>\",\n\t\t\t\t\"content\": \"<$text text={{{ [<currentTiddler>get[text]jsonstringify[]] }}}/>\"\n\t\t\t}\n\t\t</$list>\n\t]\n}"},"$:/plugins/tiddlywiki/ai-tools/servers/openai":{"title":"$:/plugins/tiddlywiki/ai-tools/servers/openai","tags":"$:/tags/AI/CompletionServer","url":"https://api.openai.com","caption":"OpenAI Service","text":"\\rules only filteredtranscludeinline transcludeinline macrodef macrocallinline html conditional commentblock commentinline\n{\n\t\"model\": \"gpt-4o\",\n\t\"messages\": [\n\t\t{\n\t\t\t\"role\": \"system\",\n\t\t\t\"content\": \"<$text text={{{ [<conversationTitle>get[system-prompt]jsonstringify[]] }}}/>\"\n\t\t}\n\t\t<!-- Loop through the tiddlers tagged with this one to pick up all the messages in the conversation -->\n\t\t<$list filter=\"[all[shadows+tiddlers]tag<conversationTitle>!is[draft]sort[created]]\">\n\t\t\t,\n\t\t\t{\n\t\t\t\t<!-- We use JSON stringify to escape the characters that can't be used directly in JSON -->\n\t\t\t\t\"role\": \"<$text text={{{ [<currentTiddler>get[role]jsonstringify[]] }}}/>\",\n\t\t\t\t\"content\": [\n\t\t\t\t\t{\n\t\t\t\t\t\t\"type\": \"text\",\n\t\t\t\t\t\t\"text\": \"<$text text={{{ [<currentTiddler>get[text]jsonstringify[]] }}}/>\"\n\t\t\t\t\t}\n\t\t\t\t\t<%if [<currentTiddler>get[image]else[]!match[]] %>\n\t\t\t\t\t\t,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\"type\": \"image_url\",\n\t\t\t\t\t\t\t\"image_url\": {\n\t\t\t\t\t\t\t\t\"url\": \"<$text text={{{ [[data:]] [<currentTiddler>get[image]get[type]] [[;base64,]] [<currentTiddler>get[image]get[text]jsonstringify[]] +[join[]] }}}/>\"\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t<%endif%>\n\t\t\t\t]\n\t\t\t\t\n\t\t\t}\n\t\t</$list>\n\t]\n}"},"$:/plugins/tiddlywiki/ai-tools/settings":{"title":"$:/plugins/tiddlywiki/ai-tools/settings","text":"! AI Tools Settings\n\nThis plugin runs entirely in the browser, with no backend server component. A consequence of this design is that the API keys required to access external services must be obtained by the end user. These keys are stored in the browser and so only need to be set up once.\n\n!! ~OpenAI API key\n\n# Register for an account at https://platform.openai.com/\n#* Newly registered accounts can claim a small amount of credit, thereafter payment is needed\n#* Note that ~OpenAI run completely different payment systems for ~ChatGPT and the API platform. Even if you are already a subscriber to ~ChatGPT you will still need to pay for API usage after the initial free service\n# Visit https://platform.openai.com/api-keys to create a new secret API key\n# Copy and paste the value into the box below\n\n~OpenAI Secret API Key: <$password name=\"openai-secret-key\"/>\n\n"},"$:/plugins/tiddlywiki/ai-tools/styles":{"title":"$:/plugins/tiddlywiki/ai-tools/styles","tags":"[[$:/tags/Stylesheet]]","text":"\\rules only filteredtranscludeinline transcludeinline macrodef macrocallinline\n\n.ai-conversation {\n\tbackground: #f0eeff;\n\tborder-radius: 2em;\n\tpadding: 1em 1em;\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 1em;\n\tbox-shadow: 2px 2px 5px rgba(0,0,0,0.2);\n}\n\n.ai-conversation .ai-message {\n\tbox-shadow: 2px 2px 5px rgba(0,0,0,0.2);\n\tborder-radius: 1em;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.ai-conversation .ai-message .ai-message-toolbar {\n\tbackground: rgba(1,1,1,0.35);\n\tcolor: white;\n\tpadding: 0.25em 1em 0.25em 1em;\n\tborder-top-left-radius: 1em;\n\tborder-top-right-radius: 1em;\n\tdisplay: flex;\n\tjustify-content: space-between;\n}\n\n.ai-conversation .ai-message .ai-message-toolbar .tc-tiddlylink {\n\tcolor: inherit;\n}\n\n.ai-conversation .ai-message .ai-message-toolbar .ai-message-toolbar-button {\n\tbackground: rgba(255,255,255,0.35);\n\tcolor: #333333;\n\tcursor: pointer;\n\tdisplay: inline-block;\n\toutline: 0;\n\toverflow: hidden;\n\tpointer-events: auto;\n\tposition: relative;\n\ttext-align: center;\n\ttouch-action: manipulation;\n\tuser-select: none;\n\t-webkit-user-select: none;\n\tvertical-align: top;\n\twhite-space: nowrap;\n\tborder: 0;\n\tborder-radius: 4px;\n}\n\n.ai-conversation .ai-message .ai-message-toolbar .ai-message-toolbar-button:hover {\n\tcolor: #ffffff;\n\tbackground: rgba(255,255,255,0.55);\n\n}\n\n.ai-conversation .ai-message .ai-message-body {\n\tpadding: 0 1em 0 1em\n}\n\n.ai-conversation .ai-message.ai-message-role-system {\n\twidth: 60%;\n\tbackground: #4c4c80;\n\tcolor: white;\n}\n\n.ai-conversation .ai-message.ai-message-role-user {\n\twidth: 60%;\n\tmargin-left: auto;\n\tbackground: #ffcde0;\n}\n\n.ai-conversation .ai-message.ai-message-role-assistant {\n\tbackground: #dfd;\n}\n\n.ai-conversation .ai-message.ai-message-role-error {\n\tbackground: #fdd;\n}\n\n.ai-conversation .ai-user-prompt {\n\tpadding: 1em;\n\tbackground: #ffcde0;\n\tborder-radius: 1em;\n\tbox-shadow: inset 3px 4px 2px rgba(0, 0, 0, 0.1);\n}\n\n.ai-conversation .ai-user-prompt button svg.tc-image-button {\n\tfill: #000;\n}\n\n.ai-conversation .ai-user-prompt-text {\n\tdisplay: flex;\n\talign-items: flex-start;\n\tgap: 1em;\n}\n\n.ai-conversation .ai-user-prompt button.ai-user-prompt-send {\n\tbackground-color: initial;\n\tbackground-image: linear-gradient(-180deg, #e0c3ce, #963057);\n\tborder-radius: 1em;\n\tbox-shadow: rgba(0, 0, 0, 0.1) 0 2px 4px;\n\tcolor: #FFFFFF;\n\tcursor: pointer;\n\tdisplay: inline-block;\n\toutline: 0;\n\toverflow: hidden;\n\tpadding: 0 20px;\n\tpointer-events: auto;\n\tposition: relative;\n\ttext-align: center;\n\ttouch-action: manipulation;\n\tuser-select: none;\n\t-webkit-user-select: none;\n\tvertical-align: top;\n\twhite-space: nowrap;\n\tborder: 0;\n\ttransition: box-shadow .2s;\n\tline-height: 2;\n}\n\n.ai-conversation .ai-user-prompt button.ai-user-prompt-send:hover:not(:disabled) {\n\tbox-shadow: rgb(255 62 135 / 64%) 0 3px 8px;\n}\n\n.ai-conversation .ai-user-prompt button.ai-user-prompt-send:disabled {\n\tbackground: #ddd;\n\tcolor: #444;\n}\n\n.ai-conversation .ai-user-prompt textarea {\n\tmargin: 0;\n}\n\n.ai-request-spinner {\n\tanimation: ai-request-spinner-animation-rotate 1s infinite;\n\theight: 50px;\n\twidth: 50px;\n\tmargin-left: auto;\n\tmargin-right: auto;\n}\n\n.ai-request-spinner:before,\n.ai-request-spinner:after {\n\tborder-radius: 50%;\n\tcontent: \"\";\n\tdisplay: block;\n\theight: 20px;\n\twidth: 20px;\n}\n\n.ai-request-spinner:before {\n\tanimation: ai-request-spinner-animation-ball1 1s infinite;\n\tbackground-color: #ddffdd;\n\tbox-shadow: 30px 0 0 #90a690;\n\tmargin-bottom: 10px;\n}\n\n.ai-request-spinner:after {\n\tanimation: ai-request-spinner-animation-ball2 1s infinite;\n\tbackground-color: #90a690;\n\tbox-shadow: 30px 0 0 #ddffdd;\n}\n\n@keyframes ai-request-spinner-animation-rotate {\n\t0% { transform: rotate(0deg) scale(0.8) }\n\t50% { transform: rotate(360deg) scale(1.2) }\n\t100% { transform: rotate(720deg) scale(0.8) }\n}\n\n@keyframes ai-request-spinner-animation-ball1 {\n\t0% {\n\t\tbox-shadow: 30px 0 0 #90a690;\n\t}\n\t50% {\n\t\tbox-shadow: 0 0 0 #90a690;\n\t\tmargin-bottom: 0;\n\t\ttransform: translate(15px, 15px);\n\t}\n\t100% {\n\t\tbox-shadow: 30px 0 0 #90a690;\n\t\tmargin-bottom: 10px;\n\t}\n}\n\n@keyframes ai-request-spinner-animation-ball2 {\n\t0% {\n\t\tbox-shadow: 30px 0 0 #ddffdd;\n\t}\n\t50% {\n\t\tbox-shadow: 0 0 0 #ddffdd;\n\t\tmargin-top: -20px;\n\t\ttransform: translate(15px, 15px);\n\t}\n\t100% {\n\t\tbox-shadow: 30px 0 0 #ddffdd;\n\t\tmargin-top: 0;\n\t}\n}"},"$:/plugins/tiddlywiki/ai-tools/view-templates/conversation":{"title":"$:/plugins/tiddlywiki/ai-tools/view-templates/conversation","tags":"$:/tags/ViewTemplate","list-after":"$:/core/ui/ViewTemplate/body","text":"<!--\n-->\n\\function statusTitle()\n[<currentTiddler>addprefix[$:/temp/ai-tools/status/]]\n\\end statusTitle\n\n<!--\nProcedure to display a message from an AI conversation. Current tiddler is the conversation tiddler\n-->\n\\procedure ai-message(tiddler,field,role,makeLink:\"yes\")\n<$qualify\n\tname=\"state\"\n\ttitle={{{ [[$:/state/ai-message-state/]addsuffix<tiddler>] }}}\n>\n\t<$let\n\t\teditStateTiddler={{{ [<state>addsuffix[-edit-state]] }}}\n\t\teditState={{{ [<editStateTiddler>get[text]else[view]]  }}}\n\t>\n\t\t<div class={{{ ai-message [<role>addprefix[ai-message-role-]] +[join[ ]] }}}>\n\t\t\t<div class=\"ai-message-toolbar\">\n\t\t\t\t<div class=\"ai-message-toolbar-left\">\n\t\t\t\t\t<$genesis $type={{{ [<makeLink>match[yes]then[$link]else[span]] }}} to=<<tiddler>>>\n\t\t\t\t\t\t<$text text=<<role>>/>\n\t\t\t\t\t</$genesis>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"ai-message-toolbar-left\">\n\t\t\t\t\t<%if [<editState>!match[edit]] %>\n\t\t\t\t\t\t<$button class=\"ai-message-toolbar-button\">\n\t\t\t\t\t\t\t<$action-setfield $tiddler=<<editStateTiddler>> text=\"edit\"/>\n\t\t\t\t\t\t\tedit\n\t\t\t\t\t\t</$button>\n\t\t\t\t\t<%endif%>\n\t\t\t\t\t<%if [<editState>!match[view]] %>\n\t\t\t\t\t\t<$button class=\"ai-message-toolbar-button\">\n\t\t\t\t\t\t\t<$action-setfield $tiddler=<<editStateTiddler>> text=\"view\"/>\n\t\t\t\t\t\t\tview\n\t\t\t\t\t\t</$button>\n\t\t\t\t\t<%endif%>\n\t\t\t\t\t<$button class=\"ai-message-toolbar-button\">\n\t\t\t\t\t\t<$action-sendmessage $message=\"tm-copy-to-clipboard\" $param={{{ [<tiddler>get<field>else[]] }}}/>\n\t\t\t\t\t\tcopy\n\t\t\t\t\t</$button>\n\t\t\t\t\t<$button class=\"ai-message-toolbar-button\">\n\t\t\t\t\t\t<$action-deletetiddler $tiddler=<<tiddler>>/>\n\t\t\t\t\t\tdelete\n\t\t\t\t\t</$button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class=\"ai-message-body\">\n\t\t\t\t<%if [<editState>match[view]] %>\n\t\t\t\t\t<$transclude $tiddler=<<tiddler>> $field=<<field>> $mode=\"block\"/>\n\t\t\t\t<%else%>\n\t\t\t\t\t<$edit-text tiddler=<<tiddler>> field=<<field>> tag=\"textarea\" class=\"tc-edit-texteditor\"/>\n\t\t\t\t<%endif%>\n\t\t\t\t<%if [<tiddler>get[image]else[]!match[]] %>\n\t\t\t\t\t<$image source={{{ [<tiddler>get[image]] }}}/>\n\t\t\t\t<%endif%>\n\t\t\t</div>\n\t\t</div>\n\t</$let>\n</$qualify>\n\\end ai-message\n\n<!--\nAction procedure to get the next response from the LLM\n-->\n\\procedure action-get-response()\n<$let\n\tresultTitlePrefix={{{ [<currentTiddler>addsuffix[ - Prompt]] }}}\n\tresultTags={{{ [<currentTiddler>format:titlelist[]] }}}\n>\n\t<$action-createtiddler\n\t\t$basetitle=<<resultTitlePrefix>>\n\t\ttags=<<resultTags>>\n\t\ttype=\"text/markdown\"\n\t\trole=\"user\"\n\t\ttext={{!!current-response-text}}\n\t\timage={{!!current-response-image}}\n\t>\n\t\t<$action-deletefield $tiddler=<<currentTiddler>> $field=\"current-response-text\"/>\n\t\t<$action-deletefield $tiddler=<<currentTiddler>> $field=\"current-response-image\"/>\n\t\t<$transclude\n\t\t\t$variable=\"get-llm-completion\"\n\t\t\tconversationTitle=<<currentTiddler>>\n\t\t\tcompletionServer={{!!completion-server}}\n\t\t\tresultTitlePrefix=<<resultTitlePrefix>>\n\t\t\tresultTags=<<resultTags>>\n\t\t\tstatusTitle=<<statusTitle>>\n\t\t/>\n\t</$action-createtiddler>\n</$let>\n\\end action-get-response\n\n<%if [<currentTiddler>tag[$:/tags/AI/Conversation]] %>\n\nServer: <$select tiddler=<<currentTiddler>> field=\"completion-server\" default=<<default-llm-completion-server>>>\n<$list filter=\"[all[shadows+tiddlers]tag[$:/tags/AI/CompletionServer]sort[caption]]\">\n<option value=<<currentTiddler>>><$view field='caption'/></option>\n</$list>\n</$select>\n\n<div class=\"ai-conversation\">\n\t<$transclude\n\t\t$variable=\"ai-message\"\n\t\ttiddler=<<currentTiddler>>\n\t\tfield=\"system-prompt\"\n\t\trole=\"system\"\n\t\tmakeLink=\"no\"\n\t/>\n\t<$list filter=\"[all[shadows+tiddlers]tag<currentTiddler>!is[draft]sort[created]]\" variable=\"message\" storyview=\"pop\">\n\t\t<$transclude\n\t\t\t$variable=\"ai-message\"\n\t\t\ttiddler=<<message>>\n\t\t\tfield=\"text\"\n\t\t\trole={{{ [<message>get[role]] }}}\n\t\t/>\n\t</$list>\n\t<%if [<statusTitle>get[text]else[complete]match[pending]] %>\n\t\t<div class=\"ai-request-status\">\n\t\t\t<div class=\"ai-request-spinner\"></div>\n\t\t</div>\n\t<%endif%>\n\t<div class=\"ai-user-prompt\">\n\t\t<div class=\"ai-user-prompt-text\">\n\t\t\t<$edit-text tiddler=<<currentTiddler>> field=\"current-response-text\" tag=\"textarea\" class=\"tc-edit-texteditor\"/>\n\t\t\t<$button\n\t\t\t\tclass=\"ai-user-prompt-send\"\n\t\t\t\tactions=<<action-get-response>>\n\t\t\t\tdisabled={{{ [<statusTitle>get[text]else[complete]match[pending]then[yes]] [<currentTiddler>get[current-response-text]else[]match[]then[yes]] ~[[no]] }}}\n\t\t\t>\n\t\t\t\tSend\n\t\t\t</$button>\n\t\t</div>\n\t\t<div class=\"ai-user-prompt-image\">\n\t\t\t<div class=\"tc-drop-down-wrapper\">\n\t\t\t\t<$let state=<<qualify \"$:/state/ai-user-prompt-image-dropdown-state/\">>>\n\t\t\t\t\t<$button popup=<<state>> class=\"tc-btn-invisible tc-btn-dropdown\">Choose an image {{$:/core/images/down-arrow}}</$button>\n\t\t\t\t\t<$link to={{!!current-response-image}}>\n\t\t\t\t\t\t<$text text={{!!current-response-image}}/>\n\t\t\t\t\t</$link>\n\t\t\t\t\t<$reveal state=<<state>> type=\"popup\" position=\"belowleft\" text=\"\" default=\"\" class=\"tc-popup-keep\">\n\t\t\t\t\t\t<div class=\"tc-drop-down\" style=\"text-align:center;\">\n\t\t\t\t\t\t\t<$transclude\n\t\t\t\t\t\t\t\t$variable=\"image-picker\"\n\t\t\t\t\t\t\t\tfilter=\"[all[shadows+tiddlers]is[image]is[binary]!has[_canonical_uri]] -[type[application/pdf]] +[!has[draft.of]sort[title]]\"\n\t\t\t\t\t\t\t\tactions=\"\"\"\n\t\t\t\t\t\t\t\t\t<$action-setfield\n\t\t\t\t\t\t\t\t\t\t$tiddler=<<currentTiddler>>\n\t\t\t\t\t\t\t\t\t\tcurrent-response-image=<<imageTitle>>\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t<$action-deletetiddler $tiddler=<<state>>/>\n\t\t\t\t\t\t\t\t\"\"\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</$reveal>\n\t\t\t\t</$let>\n\t\t\t\t<$image source={{!!current-response-image}}/>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n\n\n<%endif%>\n\n"}}}